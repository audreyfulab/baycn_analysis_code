names (which (db.entrez=="5465"))
db.entrez$NR1C1
typeof (names (which (db.entrez=="5465")))
length (names (which (db.entrez=="5465")))
(220-47)*0.6
(220-47)*0.85
?chisq.test
x <- matrix (c(106, 66, 172/2, 172/2), ncol=2)
chisq.test(x)
x <- matrix (c(106, 66, 22, 21), ncol=2)
x
chisq.test(x)
1050*1000
1050*1000*12*3
1000*1000 + 50*2000
1100000*36
137.79 + 127.91 + 81.61 + 95.11
7645.11 + 1309.59
7645.11 + 1309.59 + 523.71 + 705.28
install.packages("TwoSampleMR", repos = c("https://mrcieu.r-universe.dev", "https://cloud.r-project.org"))
library (TwoSampleMR)
library (help=TwoSampleMR)
?mr
mr_method_list()
?mr_egger_regression
?mr_weighted_median
?mr_ivw
food <- c(20.83, 17.12, 13.35, 15.66, 14.8, 33.98, 5.18)
sum (food)
transport <- c(45, 8, 5.5*4)
sum (transport)
misc <- c(75.08, 572.4, 186.96, 230, 595)
sum (misc)
sum (misc) + 75 + sum (food)
c(38, 4, 14, 7)
#######################################
# Fisher's exact test for a 2x2 table
#######################################
treatments <- matrix (c(38, 4, 14, 7), nrow = 2, byrow = TRUE)
treatments
colnames(treatments)
colnames(treatments) <- c("Success", "Failure")
treatments
rownames(treatments) <- c("PV", "P")
treatments
fisher.test(treatments, alternative = "greater")
?fisher.test
treatments.fisher <- fisher.test(treatments, alternative = "greater")
treatments.fisher
treatments.fisher$null.value
View(treatments)
treatments[,2]
treatments
treatments[,1]
treatments.2 <- cbind (treatments[,2], treatments[,1])
treatments.2
colnames(treatments.2) <- c("Failure", "Success")
treatments.2
rownames(treatments.2) <- c("PV", "V")
rownames(treatments) <- c("PV", "V")
treatments.2
treatments
fisher.test(treatments.2, alternative = "less")
fisher.test(treatments, alternative = "greater")
sum (patients)
#######################################
# Chi-squared test for count data
#######################################
# Example: clinical trial of a drug on a random
# sample of 200 patients with high blood pressure.
# Marked reduction, modeerate reduction, slight reduction, no reduction
patients <- c(120, 60, 10, 10)
sum (patients)
# Check the expected counts
sum (patients) * standard.perc
standard.perc <- c(0.5, 0.25, 0.1, 0.15)
# Check the expected counts
sum (patients) * standard.perc
chisq.test(patients, p = standard.perc)
# Example: is there an association between patient age
# and severity of a skin disease?
skin.disease <- matrix (c(15, 32, 18, 5, 8, 29, 23, 18, 1, 20, 25, 22), nrow = 3, byrow = TRUE)
skin.disease
colnames(skin.disease) <- c("Age.I", "Age.II", "Age.III", "Age.IV")
rownames(skin.disease) <- c("Moderate", "MildlySevere", "Severe")
skin.disease
skin.chisq <- chisq.test(skin.disease)
skin.chisq
?chisq.test
skin.disease
skin.chisq$observed
skin.chisq$expected
rowsum(skin.disease)
apply (skin.disease, 1, sum)
apply (skin.disease, 2, sum)
(15 + 32    +  18 +     5)
70         +  78  +         68
24 +     81  +    66  +    45
70/216
78/216
68/216
24/216
81/216
66/216
45/216
skin.disease
216*0.11
216*0.375
23.76*0.3240741
23.76*0.3611111
23.76*0.3148148
81*0.3240741
81*0.3611111
81*0.3148148
skin.chisq$expected
View(skin.disease)
install.packages("coloc")
library (coloc)
data(coloc_test_data)
summary(coloc_test_data)
summary(coloc_test_data$D1)
summary(coloc_test_data$D2)
summary(coloc_test_data$D3)
dim(coloc_test_data$D3$beta)
length(coloc_test_data$D3$beta)
summary(coloc_test_data$D3$beta)
(coloc_test_data$D3$snp[1:10])
0.793/1.75
0.7930.43
0.793/0.43
12*6
72*0.74
53+28
library (baycn)
library (help=baycn)
?mhEdge
data_m1 <- simdata(b0 = 0,
N = 200,
s = 1,
graph = 'm1_gv',
ss = 1,
q = 0.27)
View(data_m1)
am_m1 <- matrix(c(0, 1, 0,
0, 0, 1,
0, 0, 0),
byrow = TRUE,
nrow = 3)
am_m1
mh_m1_pmr <- mhEdge(data = data_m1,
adjMatrix = am_m1,
prior = c(0.05,
0.05,
0.9),
nCPh = 0,
nGV = 1,
pmr = TRUE,
burnIn = 0.2,
iterations = 1000,
thinTo = 200,
progress = FALSE)
summary(mh_m1_pmr)
am_m1_undirected <- matrix(c(0, 1, 1,
1, 0, 1,
1, 1, 0),
byrow = TRUE,
nrow = 3)
mh_m1_pmr <- mhEdge(data = data_m1,
adjMatrix = am_m1_undirected,
prior = c(0.05,
0.05,
0.9),
nCPh = 0,
nGV = 1,
pmr = TRUE,
burnIn = 0.2,
iterations = 1000,
thinTo = 200,
progress = FALSE)
summary(mh_m1_pmr)
?install.packages
12*4*40*0.05
12*4*40*0.05/12
400/50
library (BCDAG)
library (help=BCDAG)
?leukemia
?learn_DAG
install.packages("devtools")
install.packages ("BiocManager")
BiocManager::install ('AnnotationDbi')
BiocManager::install ('GO.db')
BiocManager::install ('graph')
BiocManager::install ('impute')
BiocManager::install ('preprocessCore')
BiocManager::install ('RBGL')
BiocManager::install ('Rgraphviz')
library(devtools)
Sys.getenv("R_MAKEVARS_USER")
R.version$platform
Sys.which("gfortran")
file.exists("~/.R/Makevars")
system("R CMD config FC",  intern = TRUE)   # /opt/gfortran/bin/gfortran
system("R CMD config F77", intern = TRUE)   # /opt/gfortran/bin/gfortran
library (baycn)
library (help=baycn)
?mhEdge
devtools::install_github('evanamartin/baycn')
devtools::install_github('evanamartin/baycn', force=TRUE)
#### 5. Writing and Debugging Functions ####
# Example
zscore <- function(x) {
x.mean <- mean(x)
x.adj <- x - x.mean
result <- x.adj / s
return (result)
}
debug(zscore)
test <- rnorm (10)
zscore(test)
#### 6. Writing R Packages ####
#### 6. Writing R Packages ####
# https://hilaryparker.com/2014/04/29/writing-an-r-package-from-scratch/
print (result)
undebug (zscore)
library (baycn)
?mhEdge
###########################################
# 2026.01.08
# apply baycn to DC ablation data
###########################################
library (readxl)
# Read in proportions from all cell types
cells.dc <- read_excel("~/Documents/Data/GrannemanLab/Rondini_dtr_ScadenPredictions_111925.xlsx", sheet = 1)
# Transpose the data matrix so that cell types are in the columns
cells.dc.t <- t(cells.dc[,-1])
colnames(cells.dc.t) <- cells.dc[[1]]
# Remove the first cell type
# Merge all DC types
dc.merged <- apply (cells.dc.t[,7:10], 1, sum)
cells.dc.t.new <- cbind (cells.dc.t[,2:6], dc.merged, cells.dc.t[,11:30])
colnames(cells.dc.t.new)[6] <- "DC"
# Logit transformation of proportions
cells.data.new <- log(cells.dc.t.new / (1-cells.dc.t.new))
# assume cells.data.new is a data.frame or matrix
df <- as.data.frame(cells.data.new)
# Parse the row names and extract experimental conditions
# extract row names
rn <- rownames(df)
# split by underscore
parts <- do.call(rbind, strsplit(rn, "_"))
# 0/1 coding
df$Sex  <- ifelse(parts[,1] == "M",   1, 0)   # M = 1, F = 0
df$DTR  <- ifelse(parts[,2] == "DTR", 1, 0)   # DTR = 1, WT = 0
df$Temp <- ifelse(parts[,3] == "COLD",1, 0)   # COLD = 1, RT = 0
# move new variables to the left of data frame
df.new <- df[,c(27:29, 1:26)]
# build initial graph
cells.all.adj <- matrix (1, nrow = ncol(df.new), ncol = ncol(df.new))
diag(cells.all.adj) <- 0
# remove edges among the three binary variables
cells.all.adj[1:3, 1:3] <- 0
iterations <- 50000
# run baycn
cells.all.new.baycn <- mhEdge(adjMatrix = cells.all.adj,
burnIn = 0.2,
data = as.matrix(df.new),
iterations = iterations,
nGV = 3,
pmr = TRUE,
prior = c(0.05,
0.05,
0.9),
thinTo = 200,
progress = TRUE)
dc.posteriorES <- cells.all.new.baycn@posteriorES
View(dc.posteriorES)
####################################################
# Calculating probabilities and quantiles
# under an arbitrary normal distribution
####################################################
# generate 1000 numbers from standard normal
data1 <- rnorm (n = 1000, mean = 0, sd = 1)
data1
# generate the boxplot
boxplot(data1)
# plot the relative frequency histogram
hist (data1, col="magenta", freq=FALSE)
# generate 1000 numbers from N(mean=20,sd=2)
data2 <- rnorm (n=1000, mean=20, sd=2)
# plot the relative frequency histogram
hist (data2, col="green", freq=FALSE)
# calculate the probability under standard normal
# P(Z<0.5)
pnorm(q = 0.5, mean = 0, sd = 1, lower.tail = TRUE)
# P(Z>0.5)
pnorm(q = 0.5, mean = 0, sd = 1, lower.tail = FALSE)
1- pnorm(q = 0.5, mean = 0, sd = 1, lower.tail = TRUE)
# calculate the probability under arbitrary normal
# Y ~ N(mu=20, sigma^2=4)
# P(Y>25)
pnorm (q = 25, mean = 20, sd = 2, lower.tail = FALSE)
# find the quantile z1 such that P(Z > z1) = 0.05
qnorm (0.05, mean=0, sd=1, lower.tail=FALSE)
# find the quantile z2 such that P(Z > z2) = 0.025
qnorm (0.025, mean=0, sd=1, lower.tail=FALSE)
# find the quantile z3 such that P(Z < z3) = 0.025
qnorm (0.025, mean=0, sd=1, lower.tail=TRUE)
############################################
# Binomial distribution
############################################
coins <- rbinom(n=1, size = 20, prob = 0.45)
coins
############################################
# Binomial distribution
############################################
coins <- rbinom(n=1, size = 20, prob = 0.45)
coins
############################################
# Binomial distribution
############################################
coins <- rbinom(n=1, size = 20, prob = 0.45)
coins
coins <- rbinom(n=1000, size = 20, prob = 0.45)
coins
# plot the relative frequency histogram
hist (coins, col="magenta", freq = FALSE)
20*0.45
pbinom (q = 5, size = 20, prob = 0.45)
setwd("~/Documents/Courses/FPH7350_Winter2026/Data")
####################################################
# Data matrix
####################################################
# A clinical trial for an epileptic drug recruited 59 patients.  The patients were randomly given a placebo
# or the drug, and visited the clinic once every two weeks for four times.
# Their number of seizures during the previous 2 weeks was recorded.
epilepsy <- read.delim ("epilepsy.txt", header=TRUE, sep="\t")
View(epilepsy)
# type of the R object
typeof (epilepsy)
epilepsy$Age
# access values in data frame
epilepsy$Age[1:5]
# access values in data frame
epilepsy$Age[5]
# access values in data frame
epilepsy$Age[3]
epilepsy[8,2]
setwd("~/Documents/Programs/baycn_analysis_code/drosophila_analysis")
load("drosophila.continuous.scan_posterior.RData")
rm (epilepsy)
rm (coins)
rm (data1)
rm (data2)
View(scan_posterior)
library (baycn)
colnames(scan_posterior) <- colnames(drosophila$continuous)
write.table(scan_posterior, "bma_drosophila_adj_mtx.txt", col.names = TRUE, row.names = FALSE, sep = "\t", quote = FALSE)
load("drosophila.continuous.scan_posterior.runtime.RData")
total_time
View(scan_posterior)
colnames(scan_posterior)
setwd("~/Documents/Programs/baycn_analysis_code/simulation_analysis_with_fully_connected_input")
########### read performance evaluation ###########
# G2
g2_all <- read.delim("g2_prerec_mse2_all_methods_table.tsv", header = TRUE, sep = "\t", na.strings = "-")
# pc
pc_all <- read.delim("pc_prerec_mse2_all_methods_table.tsv", header = TRUE, sep = "\t", na.strings = "-")
# nc11
nc11_all <- read.delim("nc11_prerec_mse2_all_methods_table_merged.tsv", header = TRUE, sep = "\t", na.strings = "-")
########### visualization ###########
methods <- c(setdiff(unique(nc11_all$Method), "baycn"), "baycn")
# "baycn", "mc3", "order", "partition", "bcdag", "scanBMA"
mycolors <- c("orange", "green", "magenta", "blue", "brown", "black")
mycolors.lines <- adjustcolor(mycolors, alpha.f = 0.5)
`%||%` <- function(a, b) {
if (!is.null(a)) a else b
}
plot_with_SD_bars <- function(data, xvar, yvar, xsdvar, ysdvar,
method_col = "Method", methods = NULL,
colors = NULL, pch = 16, cex = 1.2,
xlab = NULL, ylab = NULL,
legend=FALSE, legend_position = NULL,
diagonal=FALSE,
sd_colors = NULL, sd_lty = 1, sd_lwd=0.8,...) {
# Map each method to color
method_colors <- setNames(colors, methods)
line_colors <- setNames(sd_colors, methods)
# Plot base
plot(data[[xvar]], data[[yvar]], type = "n",
xlab = xlab %||% xvar, ylab = ylab %||% yvar, ...)
if (diagonal){
abline(a = 0, b = 1, lty=3)
}
for (m in methods) {
idx <- which(data[[method_col]] == m)
x <- data[[xvar]][idx]
y <- data[[yvar]][idx]
xsd <- data[[xsdvar]][idx]
ysd <- data[[ysdvar]][idx]
col <- method_colors[[m]]
sd_col <- line_colors[[m]]
# Error bars
arrows(x - xsd, y, x + xsd, y, angle = 90, code = 3, length = 0.02, col = sd_col, lty = sd_lty, lwd = sd_lwd)
arrows(x, y - ysd, x, y + ysd, angle = 90, code = 3, length = 0.02, col = sd_col, lty = sd_lty, lwd = sd_lwd)
# Points
points(x, y, col = col, pch = pch, cex = cex)
}
if (legend){
legend(legend_position,
legend = methods,
col = colors,
pch = pch,
pt.cex = cex,
bty = "n",  # no box around legend
cex = 0.9,
y.intersp = 0.8)
}
}
# Adjust spacing
old_par <- par(no.readonly = TRUE)
on.exit(par(old_par))
#pdf("Plot_power_precision_g2_nc11_pc.pdf")
svg("Plot_power_precision_g2_nc11_pc.svg")
par(mar = c(3.5, 3.5, 0.5, 0.5), mgp = c(2, 0.5, 0))
par(mfrow=c(3,3))
#### g2
# recall vs precision
plot_with_SD_bars(g2_all,
xvar = "Precision.Mean", yvar = "Recall.Mean",
xsdvar = "Precision.SD", ysdvar = "Recall.SD",
methods = methods,
colors = mycolors,
sd_colors = mycolors.lines,
legend = TRUE, legend_position = "topleft",
xlab = "Precision", ylab = "Power", diagonal = TRUE, xlim=c(0, 1), ylim=c(0,1))
# MSE2 vs precision
plot_with_SD_bars(g2_all,
xvar = "Precision.Mean", yvar = "MSE.Mean",
xsdvar = "Precision.SD", ysdvar = "MSE.SD",
methods = methods,
colors = mycolors,
sd_colors = mycolors.lines,
xlab = "Precision", ylab = "MSE2", xlim=c(0, 1), ylim=c(0, 0.3))
# MSE2 vs recall
plot_with_SD_bars(g2_all,
xvar = "Recall.Mean", yvar = "MSE.Mean",
xsdvar = "Recall.SD", ysdvar = "MSE.SD",
methods = methods,
colors = mycolors,
sd_colors = mycolors.lines,
xlab = "Power", ylab = "MSE2", xlim=c(0, 1), ylim=c(0, 0.3))
#### NC11
# recall vs precision
plot_with_SD_bars(nc11_all,
xvar = "Precision.Mean", yvar = "Recall.Mean",
xsdvar = "Precision.SD", ysdvar = "Recall.SD",
methods = methods,
colors = mycolors,
sd_colors = mycolors.lines,
sd_lty = 1,
xlab = "Precision", ylab = "Power",
diagonal = TRUE, xlim=c(0, 1), ylim=c(0,1))
# MSE2 vs precision
plot_with_SD_bars(nc11_all,
xvar = "Precision.Mean", yvar = "MSE.Mean",
xsdvar = "Precision.SD", ysdvar = "MSE.SD",
methods = methods,
colors = mycolors,
sd_colors = mycolors.lines,
sd_lty = 1,
xlab = "Precision", ylab = "MSE2",
legend_position = 'topleft',
diagonal = FALSE, xlim=c(0, 1), ylim=c(0,0.1))
# MSE2 vs recall
plot_with_SD_bars(nc11_all,
xvar = "Recall.Mean", yvar = "MSE.Mean",
xsdvar = "Recall.SD", ysdvar = "MSE.SD",
methods = methods,
colors = mycolors,
sd_colors = mycolors.lines,
sd_lty = 1,
xlab = "Power", ylab = "MSE2",
legend_position = 'topleft',
xlim=c(0, 1), ylim=c(0, 0.1))
#### pc
# recall vs precision
plot_with_SD_bars(pc_all,
xvar = "Precision.Mean", yvar = "Recall.Mean",
xsdvar = "Precision.SD", ysdvar = "Recall.SD",
methods = methods,
colors = mycolors,
sd_colors = mycolors.lines,
xlab = "Precision", ylab = "Power", diagonal = TRUE, xlim=c(0, 1), ylim=c(0,1))
# MSE2 vs precision
plot_with_SD_bars(pc_all,
xvar = "Precision.Mean", yvar = "MSE.Mean",
xsdvar = "Precision.SD", ysdvar = "MSE.SD",
methods = methods,
colors = mycolors,
sd_colors = mycolors.lines,
xlab = "Precision", ylab = "MSE2", xlim=c(0, 1), ylim=c(0, 0.14))
# MSE2 vs recall
plot_with_SD_bars(pc_all,
xvar = "Recall.Mean", yvar = "MSE.Mean",
xsdvar = "Recall.SD", ysdvar = "MSE.SD",
methods = methods,
colors = mycolors,
sd_colors = mycolors.lines,
xlab = "Power", ylab = "MSE2", xlim=c(0, 1), ylim=c(0, 0.14))
dev.off()
warnings()
